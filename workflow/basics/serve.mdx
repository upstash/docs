---
title: "Overview"
---

Use the `serve()` function to define an endpoint that runs a workflow.
It accepts two arguments:

1. **Route Function**: an async function that receives the workflow context and defines the workflow steps.
2. **Options**: configuration options for the workflow.

<CodeGroup>
    ```typescript TypeScript
    import { serve } from "@upstash/workflow/nextjs";

    export const { POST } = serve(async (context) => {
      // Route function
    }, {
      // Options
    });
    ```

    ```python Python
    from fastapi import FastAPI
    from upstash_workflow.fastapi import Serve
    from upstash_workflow import AsyncWorkflowContext

    app = FastAPI()
    serve = Serve(app)


    @serve.post("/api/example")
    async def example(context: AsyncWorkflowContext[str]) -> None:
        async def _step1() -> str:
            # define a piece of business logic as step 1
            return "step 1 result"

        result = await context.run("step-1", _step1)

        async def _step2() -> None:
            # define another piece of business logic as step 2
            pass

        await context.run("step-2", _step2)
    ```
</CodeGroup>

## Route Function

The route function defines the execution logic of the workflow.
It is an async function that receives a context object, which is automatically created and passed by Upstash Workflow.

The context object provides:
- **Workflow APIs** â€“ functions for defining workflow steps.
- **Workflow Run Properties** â€“ request payload, request headers, and other metadata.

For a full list of available APIs and properties, see the [Workflow Context](/workflow/basics/context) documentation.

<CodeGroup>
    ```typescript TypeScript focus={4-10}
    import { serve } from "@upstash/workflow/nextjs";

    export const { POST } = serve(
        async (context) => {
            // ðŸ‘‡ Access context properties
            const { userId } = context.requestPayload;

            // ðŸ‘‡ Define a workflow step
            await context.run("step-1", async () => {})
        }
    );
    ```

    ```python Python
    from fastapi import FastAPI
    from upstash_workflow.fastapi import Serve
    from upstash_workflow import AsyncWorkflowContext

    app = FastAPI()
    serve = Serve(app)


    @serve.post("/api/example")
    async def example(context: AsyncWorkflowContext[str]) -> None:
        async def _step1() -> str:
            # define a piece of business logic as step 1
            return "step 1 result"

        result = await context.run("step-1", _step1)

        async def _step2() -> None:
            # define another piece of business logic as step 2
            pass

        await context.run("step-2", _step2)

    ```
</CodeGroup>

## Options

Options provide additional configuration for workflow runs.
Most of them are advanced settings and are not required for typical use cases. See [Advanced Options](/workflow/basics/serve/advanced) for more details.

<CodeGroup>

    ```typescript TypeScript focus={5-8}
    import { serve } from "@upstash/workflow/nextjs";

    export const { POST } = serve(
        async (context) => { ... },
        // ðŸ‘‡ Workflow options
        {
            failureFunction: async ({ ... }) => {}
        }
    );
    ```

    ```python Python
    from fastapi import FastAPI
    from upstash_workflow.fastapi import Serve
    from upstash_workflow import AsyncWorkflowContext

    app = FastAPI()
    serve = Serve(app)


    @serve.post("/api/example")
    async def example(context: AsyncWorkflowContext[str]) -> None:
        async def _step1() -> str:
            # define a piece of business logic as step 1
            return "step 1 result"

        result = await context.run("step-1", _step1)

        async def _step2() -> None:
            # define another piece of business logic as step 2
            pass

        await context.run("step-2", _step2)

    ```
</CodeGroup>

<ParamField path="failureFunction" type="string">
    Defines a function that executes if the workflow fails after all retries are exhausted.

    For details, see [failureFunction](/workflow/features/failure-callback).

    <Note>
        When adding a `failureFunction`, you must set `useFailureFunction: true` in `client.trigger()` when starting a workflow run.
    </Note>

    <CodeGroup>
        ```typescript TypeScript
        export const { POST } = serve<string>(
        async (context) => { ... },
        {
          failureFunction: async ({
            context,      // context during failure
            failStatus,   // failure status
            failResponse, // failure message
            failHeaders   // failure headers
          }) => {
            // handle the failure
          }
        }
        );
        ```

        ```python Python
        async def failure_function(
          context,       # context during failure
          fail_status,   # failure status
          fail_response, # failure message
          fail_headers   # failure headers
        ):
          # handle the failure
          pass

        @serve.post("/api/example", failure_function=failure_function)
        async def example(context: AsyncWorkflowContext[str]) -> None: ...
        ```

    </CodeGroup>
</ParamField>

