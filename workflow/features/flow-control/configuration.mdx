---
title: "Configuration"
---

To limit the execution environment, configure both the `serve` and `trigger` methods. When configured, all workflow steps respect the defined limits.

#### In the `serve()` function

```typescript
import { serve } from "@upstash/workflow/nextjs";

export const { POST } = serve<string>(
  async (context) => { ... },
  {
    flowControl: {
      key: "app1",
      parallelism: 3,
      rate: 10,
      period: "1m"
    }
  }
);
```

#### In the `trigger()` function

```typescript
import { Client } from "@upstash/workflow";

const client = new Client({ token: "<QSTASH_TOKEN>" });

const { workflowRunId } = await client.trigger({
  url: "https://workflow-endpoint.com",
  flowControl: {
    key: "app1",
    parallelism: 3,
    rate: 10
  }
});
```

<Info>
    Upstash Workflow does not support step-level flow-control configuration.

    This means that flow-control configuration apply uniformly to all steps.
    You cannot configure flow-control individually for a specific step.

    However, there are exceptions for external requests made via `context.call()` or `context.invoke()`.
    Since these represent calls to external endpoints, you can specify flow-control behavior specifically for those steps, independently of the workflow-level retry settings.

    For more details on configuring flow-control for these steps, see the documentation for:
    - [context.call()]()
    - [context.invoke()]()
</Info>